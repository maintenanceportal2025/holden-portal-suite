<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lake Illawong - Maintenance System Dashboard</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Hero Section */
        .hero-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .hero-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .logo-container {
            flex-shrink: 0;
        }

        .logo-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            background: transparent;
        }

        .hero-text {
            text-align: center;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }

        .hero-subtitle {
            font-size: 1.1rem;
            color: #64748b;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .hero-description {
            font-size: 1.1rem;
            color: #475569;
            margin-top: 15px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Live Stats Dashboard */
        .stats-section {
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .stat-trend {
            font-size: 0.8rem;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
        }

        .trend-up {
            background: #dcfce7;
            color: #166534;
        }

        .trend-down {
            background: #fecaca;
            color: #dc2626;
        }

        .trend-stable {
            background: #e0e7ff;
            color: #3730a3;
        }

        /* Portal Cards */
        .portals-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: white;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .portals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .portal-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .portal-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
        }

        .portal-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .portal-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .portal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .portal-subtitle {
            font-size: 1rem;
            color: #64748b;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .portal-description {
            color: #475569;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .portal-features {
            list-style: none;
            margin-bottom: 25px;
        }

        .portal-features li {
            padding: 4px 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .portal-features li::before {
            content: '✓';
            color: #10b981;
            font-weight: bold;
            margin-right: 8px;
        }

        .portal-btn {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            text-align: center;
        }

        .portal-btn:hover {
            background: linear-gradient(135deg, #1d4ed8, #1e40af);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .access-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-protected {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-public {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-analytics {
            background: #e0e7ff;
            color: #3730a3;
        }

        /* Quick Actions */
        .quick-actions {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .quick-actions-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            text-align: center;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .action-btn {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px 20px;
            text-decoration: none;
            color: #334155;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        /* System Status */
        .system-status {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 15px;
            text-align: center;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: #f8fafc;
            border-radius: 10px;
            border-left: 4px solid #e2e8f0;
        }

        .status-online {
            border-left-color: #10b981;
        }

        .status-loading {
            border-left-color: #f59e0b;
        }

        .status-error {
            border-left-color: #ef4444;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .indicator-online {
            background: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
        }

        .indicator-loading {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }

        .indicator-error {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Footer */
        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            text-align: left;
        }

        .footer-section h4 {
            color: #1e293b;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .footer-section p, .footer-section a {
            color: #64748b;
            font-size: 0.9rem;
            text-decoration: none;
            margin-bottom: 5px;
            display: block;
        }

        .footer-section a:hover {
            color: #3b82f6;
        }

        .version-info {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #94a3b8;
            font-size: 0.8rem;
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .hero-section {
                padding: 25px 20px;
            }

            .hero-header {
                flex-direction: column;
                gap: 15px;
            }

            .hero-title {
                font-size: 2rem;
            }

            .portals-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 1.7rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .logo-image {
                width: 80px;
                height: 80px;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Focus styles for keyboard navigation */
        .portal-btn:focus,
        .action-btn:focus {
            outline: 3px solid #3b82f6;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-header">
                <div class="logo-container">
                    <img src="pelican-logo.png" class="logo-image" alt="Lake Illawong Residential Club" onerror="this.style.display='none'">
                </div>
                <div class="hero-text">
                    <h1 class="hero-title">Lake Illawong</h1>
                    <p class="hero-subtitle">Maintenance System Dashboard</p>
                </div>
            </div>
            <p class="hero-description">
                Professional maintenance management system for Lake Illawong Retirement Village. 
                Access portal tools, view system statistics, and manage maintenance operations efficiently.
            </p>
        </div>

        <!-- Live Stats Dashboard -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-number" id="totalProblems">--</div>
                    <div class="stat-label">Total Problems</div>
                    <div class="stat-trend trend-stable" id="totalTrend">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🔥</div>
                    <div class="stat-number" id="activeProblems">--</div>
                    <div class="stat-label">Active Issues</div>
                    <div class="stat-trend trend-up" id="activeTrend">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⚡</div>
                    <div class="stat-number" id="urgentProblems">--</div>
                    <div class="stat-label">Urgent Priority</div>
                    <div class="stat-trend trend-down" id="urgentTrend">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">✅</div>
                    <div class="stat-number" id="completionRate">--%</div>
                    <div class="stat-label">Completion Rate</div>
                    <div class="stat-trend trend-up" id="completionTrend">Loading...</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📅</div>
                    <div class="stat-number" id="thisWeekNew">--</div>
                    <div class="stat-label">This Week</div>
                    <div class="stat-trend trend-stable" id="weekTrend">New submissions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🏠</div>
                    <div class="stat-number">44</div>
                    <div class="stat-label">Total Units</div>
                    <div class="stat-trend trend-stable">Retirement Village</div>
                </div>
            </div>
        </div>

        <!-- Portal Access Cards -->
        <div class="portals-section">
            <h2 class="section-title">System Portals</h2>
            <div class="portals-grid">
                <!-- Maintenance Portal -->
                <div class="portal-card">
                    <div class="access-badge badge-protected">🔐 Staff Access</div>
                    <div class="portal-icon">🔧</div>
                    <h3 class="portal-title">Maintenance Portal</h3>
                    <p class="portal-subtitle">Staff Management Interface</p>
                    <p class="portal-description">
                        Complete problem management for maintenance coordinators and property managers. 
                        Edit, assign, and track all maintenance issues with priority workflow.
                    </p>
                    <ul class="portal-features">
                        <li>Priority-based dashboard with smart filtering</li>
                        <li>Real-time problem editing with dynamic dropdowns</li>
                        <li>Mobile-optimized for field work</li>
                        <li>Professional report generation</li>
                    </ul>
                    <a href="holden-maintenance-portal.html" class="portal-btn">
                        Access Maintenance Portal
                    </a>
                </div>

                <!-- Data Explorer -->
                <div class="portal-card">
                    <div class="access-badge badge-analytics">📈 Analytics</div>
                    <div class="portal-icon">🔍</div>
                    <h3 class="portal-title">Problem Data Explorer</h3>
                    <p class="portal-subtitle">Desktop Analytics & Reporting</p>
                    <p class="portal-description">
                        Advanced data analysis and reporting interface for property managers and supervisors. 
                        Comprehensive filtering, statistics, and bulk export capabilities.
                    </p>
                    <ul class="portal-features">
                        <li>6-card analytics dashboard with real-time stats</li>
                        <li>Advanced filtering by unit, status, priority, category</li>
                        <li>CSV export with date range filtering</li>
                        <li>Historical data analysis and trends</li>
                    </ul>
                    <a href="holden-desktop-explorer.html" class="portal-btn">
                        Launch Data Explorer
                    </a>
                </div>

                <!-- Resident Portal -->
                <div class="portal-card">
                    <div class="access-badge badge-public">🌍 Public Access</div>
                    <div class="portal-icon">📝</div>
                    <h3 class="portal-title">Resident Submission</h3>
                    <p class="portal-subtitle">Problem Reporting Form</p>
                    <p class="portal-description">
                        Simple, user-friendly interface for residents to submit maintenance requests. 
                        Automatic notifications and instant confirmation with tracking numbers.
                    </p>
                    <ul class="portal-features">
                        <li>Dynamic unit and resident selection</li>
                        <li>Immediate confirmation with PID tracking</li>
                        <li>Automatic email notifications to all parties</li>
                        <li>Mobile-optimized for easy submission</li>
                    </ul>
                    <a href="holden-resident-form.html" class="portal-btn">
                        Submit Maintenance Request
                    </a>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3 class="quick-actions-title">Quick Actions</h3>
            <div class="actions-grid">
                <a href="holden-maintenance-portal.html" class="action-btn">
                    ⚡ View Urgent Issues
                </a>
                <a href="holden-resident-form.html" class="action-btn">
                    🚨 Emergency Request
                </a>
                <a href="holden-desktop-explorer.html" class="action-btn">
                    📊 System Analytics
                </a>
                <a href="#" class="action-btn" onclick="downloadGuide()">
                    📖 User Guide
                </a>
                <a href="mailto:maintenance@lakeillawong.com.au" class="action-btn">
                    📞 Contact Support
                </a>
                <a href="#" class="action-btn" onclick="refreshStats()">
                    🔄 Refresh Data
                </a>
            </div>
        </div>

        <!-- System Status -->
        <div class="system-status">
            <h3 class="status-title">System Health</h3>
            <div class="status-grid">
                <div class="status-item" id="apiStatus">
                    <div style="display: flex; align-items: center;">
                        <div class="status-indicator indicator-loading" id="apiIndicator"></div>
                        <span>Google Apps Script API</span>
                    </div>
                    <span id="apiStatusText">Checking...</span>
                </div>
                <div class="status-item" id="dataStatus">
                    <div style="display: flex; align-items: center;">
                        <div class="status-indicator indicator-loading" id="dataIndicator"></div>
                        <span>Google Sheets Database</span>
                    </div>
                    <span id="dataStatusText">Checking...</span>
                </div>
                <div class="status-item" id="emailStatus">
                    <div style="display: flex; align-items: center;">
                        <div class="status-indicator indicator-loading" id="emailIndicator"></div>
                        <span>Email Notifications</span>
                    </div>
                    <span id="emailStatusText">Checking...</span>
                </div>
                <div class="status-item" id="syncStatus">
                    <div style="display: flex; align-items: center;">
                        <div class="status-indicator indicator-online" id="syncIndicator"></div>
                        <span>Portal Synchronization</span>
                    </div>
                    <span>Online</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>System Information</h4>
                    <p>Architecture: Three-Portal Integrated Solution</p>
                    <p>Technology: HTML5 + Google Apps Script</p>
                    <p>Database: Google Sheets (Real-time sync)</p>
                    <p>Hosting: Netlify Static Deployment</p>
                </div>
                <div class="footer-section">
                    <h4>Portal Versions</h4>
                    <p>Maintenance Portal: v3.0</p>
                    <p>Data Explorer: v2.0</p>
                    <p>Resident Portal: v1.0</p>
                    <p>Backend API: v5.1</p>
                </div>
                <div class="footer-section">
                    <h4>Support & Contact</h4>
                    <a href="mailto:maintenance@lakeillawong.com.au">Technical Support</a>
                    <a href="mailto:management@lakeillawong.com.au">System Administration</a>
                    <a href="#" onclick="downloadGuide()">User Documentation</a>
                    <a href="#" onclick="showSystemInfo()">System Diagnostics</a>
                </div>
            </div>
            <div class="version-info">
                <p>Lake Illawong Maintenance System Dashboard v1.0 • Built with ❤️ for efficient maintenance management • August 2025</p>
            </div>
        </div>
    </div>

    <script>
        // =================================================================
        // CONFIGURATION - DEFINITIVE API URLS FROM KNOWLEDGE BASE
        // =================================================================
        
        // Maintenance Portal API - Full CRUD operations (Create, Read, Update, Delete)
        const MAINTENANCE_API_URL = 'https://script.google.com/macros/s/AKfycbztwt4c9-rAfrZUQT9_fRi3Lwt23Mcc9ygETGAp59NZiwlbkeTjr9SBgLJXbUUtQ7R7/exec';
        
        // Data Explorer API - Read-only analytics and reporting  
        const EXPLORER_API_URL = 'https://script.google.com/macros/s/AKfycbzEWNgrtuamJxLUEo_dWCm9-WxoD-zDejn6LKwV3Vt8yCHv0CArlBVtzj1ad_JM0A6N/exec';
        
        // =================================================================
        // SYSTEM INITIALIZATION
        // =================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏠 Lake Illawong Dashboard - Initializing...');
            
            // Load live system statistics
            loadSystemStats();
            
            // Check system health
            checkSystemHealth();
            
            // Set up auto-refresh (every 5 minutes)
            setInterval(loadSystemStats, 5 * 60 * 1000);
            
            console.log('✅ Dashboard initialization complete');
        });

        // =================================================================
        // LIVE STATISTICS LOADING
        // =================================================================
        
        async function loadSystemStats() {
            console.log('📊 Loading live system statistics...');
            
            try {
                // Use Explorer API for detailed analytics (preferred source)
                const response = await fetchWithJsonp(`${EXPLORER_API_URL}?action=getExplorerStats`);
                
                if (response && response.success) {
                    updateStatsDisplay(response.data);
                    console.log('✅ Stats loaded from Explorer API:', response.data);
                } else {
                    // Fallback to Maintenance API for basic stats
                    console.log('📊 Falling back to Maintenance API for basic stats...');
                    const fallbackResponse = await fetchWithJsonp(`${MAINTENANCE_API_URL}?action=getFaultLogData`);
                    
                    if (fallbackResponse && fallbackResponse.success) {
                        const basicStats = calculateBasicStats(fallbackResponse.data);
                        updateStatsDisplay(basicStats);
                        console.log('✅ Basic stats calculated from Maintenance API');
                    } else {
                        console.warn('⚠️ Using sample statistics');
                        updateStatsDisplay(getFallbackStats());
                    }
                }
                
            } catch (error) {
                console.error('❌ Error loading stats:', error);
                updateStatsDisplay(getFallbackStats());
            }
        }

        function calculateBasicStats(problems) {
            const total = problems.length;
            const active = problems.filter(p => 
                p.problemStatus !== 'Completed' && p.problemStatus !== 'Cancelled'
            ).length;
            const urgent = problems.filter(p => p.problemPriority === 'Urgent').length;
            const completed = problems.filter(p => p.problemStatus === 'Completed').length;
            const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            // Calculate this week's new submissions
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const thisWeekNew = problems.filter(p => {
                if (!p.timestamp) return false;
                const problemDate = new Date(p.timestamp);
                return problemDate >= oneWeekAgo;
            }).length;
            
            return {
                totalProblems: total,
                activeProblems: active,
                urgentProblems: urgent,
                completionRate: completionRate,
                thisWeekNew: thisWeekNew,
                trends: {
                    total: 'Live data',
                    active: 'Live data',
                    urgent: 'Live data',
                    completion: 'Live data'
                }
            };
        }

        function updateStatsDisplay(stats) {
            // Update total problems
            document.getElementById('totalProblems').textContent = stats.totalProblems || '--';
            
            // Update active problems
            document.getElementById('activeProblems').textContent = stats.activeProblems || '--';
            
            // Update urgent problems
            document.getElementById('urgentProblems').textContent = stats.urgentProblems || '--';
            
            // Update completion rate
            document.getElementById('completionRate').textContent = `${stats.completionRate || 0}%`;
            
            // Update this week's new submissions
            document.getElementById('thisWeekNew').textContent = stats.thisWeekNew || '--';
            
            // Update trend indicators
            updateTrendIndicators(stats);
            
            console.log('📈 Stats display updated');
        }

        function updateTrendIndicators(stats) {
            const trends = stats.trends || {};
            
            // Update total trend
            const totalTrend = document.getElementById('totalTrend');
            totalTrend.textContent = trends.total || 'Current data';
            
            // Update active trend
            const activeTrend = document.getElementById('activeTrend');
            activeTrend.textContent = trends.active || 'Current data';
            
            // Update urgent trend
            const urgentTrend = document.getElementById('urgentTrend');
            urgentTrend.textContent = trends.urgent || 'Current data';
            
            // Update completion trend
            const completionTrend = document.getElementById('completionTrend');
            completionTrend.textContent = trends.completion || 'Current data';
        }

        function getFallbackStats() {
            return {
                totalProblems: 25,
                activeProblems: 18,
                urgentProblems: 3,
                completionRate: 72,
                thisWeekNew: 5,
                trends: {
                    total: 'Sample data',
                    active: 'Sample data',
                    urgent: 'Sample data',
                    completion: 'Sample data'
                }
            };
        }

        // =================================================================
        // SYSTEM HEALTH MONITORING
        // =================================================================
        
        async function checkSystemHealth() {
            console.log('🔍 Checking system health...');
            
            // Check API connectivity
            await checkAPIHealth();
            
            // Check data accessibility
            await checkDataHealth();
            
            // Check email system (simulated)
            checkEmailHealth();
        }

        async function checkAPIHealth() {
            const indicator = document.getElementById('apiIndicator');
            const statusText = document.getElementById('apiStatusText');
            const statusItem = document.getElementById('apiStatus');
            
            try {
                // Test both APIs - start with Maintenance API
                const maintenanceResponse = await fetchWithJsonp(`${MAINTENANCE_API_URL}?action=testAPI`);
                const explorerResponse = await fetchWithJsonp(`${EXPLORER_API_URL}?action=getFaultLogData`);
                
                if (maintenanceResponse?.success && explorerResponse?.success) {
                    indicator.className = 'status-indicator indicator-online';
                    statusText.textContent = 'Both APIs Online';
                    statusItem.className = 'status-item status-online';
                    console.log('✅ Both API health checks passed');
                } else if (maintenanceResponse?.success || explorerResponse?.success) {
                    indicator.className = 'status-indicator indicator-loading';
                    statusText.textContent = 'Partial connectivity';
                    statusItem.className = 'status-item status-loading';
                    console.log('⚠️ One API accessible');
                } else {
                    throw new Error('Both APIs inaccessible');
                }
                
            } catch (error) {
                indicator.className = 'status-indicator indicator-error';
                statusText.textContent = 'API Error';
                statusItem.className = 'status-item status-error';
                console.error('❌ API health checks failed:', error);
            }
        }

        async function checkDataHealth() {
            const indicator = document.getElementById('dataIndicator');
            const statusText = document.getElementById('dataStatusText');
            const statusItem = document.getElementById('dataStatus');
            
            try {
                // Check data accessibility from Explorer API (preferred for analytics)
                const response = await fetchWithJsonp(`${EXPLORER_API_URL}?action=getFaultLogData`);
                
                if (response && response.success && response.data) {
                    indicator.className = 'status-indicator indicator-online';
                    statusText.textContent = `${response.data.length} records`;
                    statusItem.className = 'status-item status-online';
                    console.log('✅ Data health check passed via Explorer API');
                } else {
                    // Fallback to Maintenance API
                    const fallbackResponse = await fetchWithJsonp(`${MAINTENANCE_API_URL}?action=getFaultLogData`);
                    if (fallbackResponse?.success && fallbackResponse.data) {
                        indicator.className = 'status-indicator indicator-online';
                        statusText.textContent = `${fallbackResponse.data.length} records`;
                        statusItem.className = 'status-item status-online';
                        console.log('✅ Data health check passed via Maintenance API');
                    } else {
                        throw new Error('Data not accessible from either API');
                    }
                }
                
            } catch (error) {
                indicator.className = 'status-indicator indicator-error';
                statusText.textContent = 'Data Error';
                statusItem.className = 'status-item status-error';
                console.error('❌ Data health check failed:', error);
            }
        }

        function checkEmailHealth() {
            // Email system status (simulated - would need backend check for real status)
            const indicator = document.getElementById('emailIndicator');
            const statusText = document.getElementById('emailStatusText');
            const statusItem = document.getElementById('emailStatus');
            
            // Assume healthy unless proven otherwise
            indicator.className = 'status-indicator indicator-online';
            statusText.textContent = 'Online';
            statusItem.className = 'status-item status-online';
            
            console.log('✅ Email system assumed healthy');
        }

        // =================================================================
        // UTILITY FUNCTIONS
        // =================================================================
        
        function fetchWithJsonp(url) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
                const script = document.createElement('script');
                
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    resolve(data);
                };
                
                script.onerror = function() {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    reject(new Error('JSONP request failed'));
                };
                
                script.src = url + (url.includes('?') ? '&' : '?') + 'callback=' + callbackName;
                document.body.appendChild(script);
                
                // Timeout after 10 seconds
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        document.body.removeChild(script);
                        reject(new Error('JSONP request timeout'));
                    }
                }, 10000);
            });
        }

        // =================================================================
        // USER ACTIONS
        // =================================================================
        
        function refreshStats() {
            console.log('🔄 Manual stats refresh requested');
            
            // Show loading state
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach(el => el.textContent = '--');
            
            const trends = document.querySelectorAll('.stat-trend');
            trends.forEach(el => el.textContent = 'Loading...');
            
            // Reload statistics
            loadSystemStats();
            
            // Recheck system health
            checkSystemHealth();
            
            // Show user feedback
            showNotification('📊 System data refreshed', 'success');
        }

        function downloadGuide() {
            // Generate user guide content
            const guideContent = generateUserGuide();
            
            // Create downloadable file
            const blob = new Blob([guideContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Lake_Illawong_Maintenance_System_Guide.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            window.URL.revokeObjectURL(url);
            
            showNotification('📖 User guide downloaded', 'success');
        }

        function showSystemInfo() {
            const info = `
LAKE ILLAWONG MAINTENANCE SYSTEM
==================================

System Architecture:
• Frontend: HTML5 + Vanilla JavaScript
• Backend: Google Apps Script (JSONP protocol)
• Database: Google Sheets (Real-time sync)
• Authentication: Password-protected access
• Hosting: Static web hosting (Netlify compatible)

Current Versions:
• Maintenance Portal: v3.0 - Smart Priority Management
• Data Explorer: v2.0 - Enhanced Desktop Analytics
• Resident Portal: v1.0 - Resident Submission Portal
• Backend API: v5.1 - Unified Integration
• Dashboard: v1.0 - System Hub

Portal URLs:
• Maintenance: holden-maintenance-portal.html
• Explorer: holden-desktop-explorer.html
• Resident: holden-resident-form.html

Database Structure:
• Google Sheets ID: 1dmW103c3TC3M1TBqvUVyvOVGdOiARLBs9ouC5v8kD7k
• Main Tabs: FaultLog, UnitList, EmailList, Categories
• Named Ranges: Dynamic dropdown support

Authentication:
• Maintenance Portal Password: maint2025
• Data Explorer: No authentication required
• Resident Portal: Public access

Contact Information:
• Technical Support: maintenance@lakeillawong.com.au
• System Administration: management@lakeillawong.com.au

Last Updated: August 2025
Status: Production Ready ✅
            `;
            
            alert(info);
        }

        function generateUserGuide() {
            return `
LAKE ILLAWONG MAINTENANCE SYSTEM - USER GUIDE
==============================================

SYSTEM OVERVIEW:
The Lake Illawong Maintenance System consists of three integrated portals designed to streamline maintenance operations across the 44-unit retirement village.

PORTAL DESCRIPTIONS:

1. MAINTENANCE PORTAL (Staff Access - Password Required)
   • Purpose: Primary management interface for maintenance staff
   • Access: Password protected (maint2025)
   • Features: 
     - View and edit all active problems
     - Priority-based dashboard with filtering
     - Real-time search across PID, unit, description
     - Professional report generation
     - Mobile-optimized for field work
   • Users: Maintenance coordinators, property managers

2. PROBLEM DATA EXPLORER (Analytics Dashboard)
   • Purpose: Desktop-optimized analytics and reporting
   • Access: No authentication required
   • Features:
     - Advanced filtering by multiple criteria
     - 6-card statistics dashboard
     - CSV export with date range filtering
     - Historical data analysis
     - Pagination and bulk reporting
   • Users: Property managers, supervisors, analysts

3. RESIDENT SUBMISSION PORTAL (Public Access)
   • Purpose: Problem reporting interface for residents
   • Access: Public (no password required)
   • Features:
     - Simple, guided problem submission
     - Dynamic unit and resident selection
     - Immediate confirmation with tracking numbers
     - Automatic email notifications
     - Mobile-optimized for easy access
   • Users: Residents, unit owners, property managers

GETTING STARTED:

For Residents:
1. Access the Resident Submission Portal
2. Select your unit number from the dropdown
3. Choose your name from the resident list
4. Describe the maintenance problem clearly
5. Submit the form and note your tracking number (PID)
6. You'll receive email confirmation automatically

For Maintenance Staff:
1. Access the Maintenance Portal using password: maint2025
2. Use the priority dashboard to view urgent issues first
3. Search for specific problems using PID or unit number
4. Click any problem card to edit details
5. Update status, priority, assignments using dropdowns
6. Generate reports for management or record keeping

For Management/Analytics:
1. Access the Problem Data Explorer (no password needed)
2. Use the stats dashboard for quick overview
3. Apply filters to analyze specific data subsets
4. Export filtered data to CSV for external analysis
5. View individual problem details in modal windows

SYSTEM INTEGRATION:
• All portals share the same Google Sheets database
• Changes in one portal are immediately visible in others
• Email notifications are sent automatically at key stages
• Dynamic dropdowns update across all portals
• Consistent PID tracking system throughout

TECHNICAL SUPPORT:
• Email: maintenance@lakeillawong.com.au
• System Issues: Check system status on dashboard
• Password Problems: Contact system administrator
• Data Questions: Use Data Explorer for detailed analysis

TROUBLESHOOTING:
• Data not loading: Check internet connection and try refresh
• Login issues: Verify password is correct (case sensitive)
• Email not received: Check spam folder, verify email addresses
• Mobile issues: Ensure you're using an up-to-date browser

Last Updated: August 2025
System Version: Production v1.0
            `;
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                font-weight: 500;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Animate out and remove
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // =================================================================
        // ENHANCED ANALYTICS (Future Enhancement)
        // =================================================================
        
        // This could be extended to call the Data Explorer API for more detailed analytics
        async function loadDetailedAnalytics() {
            try {
                const response = await fetchWithJsonp(`${WEB_APP_URL}?action=getExplorerStats`);
                
                if (response && response.success) {
                    // Could enhance dashboard with more detailed metrics
                    console.log('📊 Detailed analytics available:', response.data);
                }
                
            } catch (error) {
                console.log('ℹ️ Detailed analytics not available');
            }
        }

        console.log('🏠 Lake Illawong Dashboard v1.0 - Ready for deployment!');
        console.log('🚀 Professional system hub connecting three production portals');
        console.log('📊 Live statistics, health monitoring, and role-based navigation');
    </script>
</body>
</html>