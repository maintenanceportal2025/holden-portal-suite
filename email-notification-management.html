<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Notification Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2d3748;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .header p {
            color: #718096;
            font-size: 0.9rem;
        }

        .section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            padding: 16px 20px;
            background: #f7fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .add-btn:hover {
            background: #3182ce;
        }

        .add-btn.green {
            background: #48bb78;
        }

        .add-btn.green:hover {
            background: #38a169;
        }

        .table-container {
            padding: 20px;
        }

        .email-table {
            width: 100%;
            border-collapse: collapse;
        }

        .email-table th {
            text-align: left;
            padding: 12px;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .email-table td {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
            position: relative;
        }

        .email-table td.editable {
            cursor: pointer;
            transition: background 0.2s;
        }

        .email-table td.editable:hover {
            background: #f7fafc;
        }

        .email-table td.editing {
            background: #fff5d6;
        }

        .email-table td.placeholder {
            color: #cbd5e0;
            font-style: italic;
        }

        .edit-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
        }

        .edit-input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.1);
        }

        .edit-select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            font-size: 0.9rem;
            background: white;
        }

        .sync-note {
            color: #718096;
            padding: 2px 20px;
            font-size: 0.85rem;
            margin-bottom: 30px;
            margin-top: -8px;
            font-style: italic;
        }

        .sync-note .icon {
            margin-right: 6px;
        }

        .submit-btn {
            background: #48bb78;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            margin: 16px 20px;
            display: none;
            transition: all 0.2s;
        }

        .submit-btn.show {
            display: inline-block;
        }

        .submit-btn:hover {
            background: #38a169;
        }

        /* Inactive Contacts Section */
        .inactive-section {
            background: #fef5e7;
            border: 1px solid #f6e05e;
        }

        .inactive-section .section-header {
            background: #fef5e7;
        }

        .inactive-section .section-title {
            color: #744210;
        }

        .inactive-table td {
            background: #fffbf0;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-right: 6px;
            transition: all 0.2s;
        }

        .restore-btn {
            background: #48bb78;
            color: white;
        }

        .restore-btn:hover {
            background: #38a169;
        }

        .delete-btn {
            background: #f56565;
            color: white;
        }

        .delete-btn:hover {
            background: #e53e3e;
        }

        .date-removed {
            font-size: 0.8rem;
            color: #718096;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .email-table th,
            .email-table td {
                padding: 8px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìß Email Notification Management</h1>
            <p>Manage maintenance team and zone representative email lists</p>
        </div>

        <!-- Maintenance Team Section -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üîß Maintenance Team
                </div>
                <button class="add-btn" onclick="showAddModal('maintenance')">+ Add New Person</button>
            </div>
            <div class="table-container">
                <table class="email-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email Address</th>
                        </tr>
                    </thead>
                    <tbody id="maintenanceTableBody">
                        <!-- Data will be loaded from Google Sheets -->
                        <tr>
                            <td colspan="2" style="text-align: center; padding: 40px; color: #718096;">
                                <div style="margin-bottom: 10px;">üì° Loading maintenance team from Google Sheets...</div>
                                <div style="font-size: 0.8rem;">If this persists, check your connection to MtceTeamEmailList</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div>
            <button class="submit-btn" id="maintenanceSubmitBtn" onclick="submitMaintenanceChanges()">üíæ Save Changes</button>
        </div>
        
        <!-- Sync note for Maintenance Team - outside section -->
        <div class="sync-note">
            <span class="icon">‚ÑπÔ∏è</span>Syncs with MtceTeamEmailList Named Range ‚Ä¢ Remove email to exclude from notifications
        </div>

        <!-- Zone Representatives Section -->
        <div class="section">
            <div class="section-header">
                <div class="section-title">
                    üè† Zone Representatives
                </div>
                <button class="add-btn green">+ Add New Zone Rep</button>
            </div>
            <div class="table-container">
                <table class="email-table">
                    <thead>
                        <tr>
                            <th>Zone</th>
                            <th>Name</th>
                            <th>Email Address</th>
                        </tr>
                    </thead>
                    <tbody id="zoneRepsTableBody">
                        <!-- Data will be loaded from Google Sheets -->
                        <tr>
                            <td colspan="3" style="text-align: center; padding: 40px; color: #718096;">
                                <div style="margin-bottom: 10px;">üì° Loading zone representatives from Google Sheets...</div>
                                <div style="font-size: 0.8rem;">If this persists, check your connection to MtceTeamEmailList</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div>
        
        <!-- Sync note for Zone Reps - outside section -->
        <div class="sync-note">
            <span class="icon">‚ÑπÔ∏è</span>Syncs with ZoneRepsEmailList Named Range (Zone | Name | Email) ‚Ä¢ Remove email to exclude from notifications
        </div>
        </div>

        <!-- Inactive Contacts Section -->
        <div class="section inactive-section">
            <div class="section-header">
                <div class="section-title">
                    üìã Inactive Contacts (Reference)
                </div>
            </div>
            <div class="table-container">
                <table class="email-table inactive-table">
                    <thead>
                        <tr>
                            <th>Name/Zone</th>
                            <th>Email</th>
                            <th>Type</th>
                            <th>Removed</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="inactiveTableBody">
                        <tr>
                            <td>John Smith</td>
                            <td>john.smith@example.com</td>
                            <td>Maintenance</td>
                            <td class="date-removed">2024-01-15</td>
                            <td>
                                <button class="action-btn restore-btn" onclick="restoreContact(1)">‚Ü©Ô∏è Restore</button>
                                <button class="action-btn delete-btn" onclick="deleteContact(1)">üóëÔ∏è Delete</button>
                            </td>
                        </tr>
                        <tr>
                            <td>Mary Johnson<br><small>Zone Rep</small></td>
                            <td>mary.johnson@example.com</td>
                            <td>Zone Rep</td>
                            <td class="date-removed">2024-02-01</td>
                            <td>
                                <button class="action-btn restore-btn" onclick="restoreContact(2)">‚Ü©Ô∏è Restore</button>
                                <button class="action-btn delete-btn" onclick="deleteContact(2)">üóëÔ∏è Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <button class="submit-btn" id="zoneSubmitBtn" onclick="submitZoneChanges()">üíæ Save Changes</button>
        </div>
    </div>

    <script>
        // Data storage
        let maintenanceTeam = [
            { id: 1, name: 'Ben Blanks', email: 'sir_tony_barnett@icloud.com' },
            { id: 2, name: 'Sue Campbell', email: 'ircresidentscommittee@gmail.com' },
            { id: 3, name: 'Tony', email: 'abarnett0@me.com' }
        ];

        let zoneReps = [
            { id: 1, zone: 'Zone 1', name: 'David Zaz', email: 'june.barnett@icloud.com' },
            { id: 2, zone: 'Zone 1', name: 'Bill Treloar', email: 'minutes.learned-98@icloud.com' },
            { id: 3, zone: 'Zone 2', name: 'Tony Barnett', email: 'sir_tony_barnett@icloud.com' },
            { id: 4, zone: 'Zone 3', name: 'Anne Fenollar', email: 'shook_equines_9f@icloud.com' },
            { id: 5, zone: 'Zone 4', name: 'Louise Castle', email: 'stick-junkier.0q@icloud.com' },
            { id: 6, zone: 'Zone 5', name: 'Lesley Newcombe', email: 'spouts-acre.0x@icloud.com' },
            { id: 7, zone: 'Zone 5', name: 'Jennifer Gardner', email: 'solar.carets71@icloud.com' }
        ];

        let inactiveContacts = [
            { id: 1, name: 'John Smith', email: 'john.smith@example.com', type: 'Maintenance', removed: '2024-01-15' },
            { id: 2, name: 'Mary Johnson', email: 'mary.johnson@example.com', type: 'Zone Rep', zone: 'Zone 2', removed: '2024-02-01' }
        ];

        // Initialize - Load data from Google Sheets
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìß Email Notification Management - Initializing...');
            loadMaintenanceTeam();
            loadZoneRepresentatives();
            loadInactiveContacts();
        });

        // Load maintenance team from Google Sheets
        async function loadMaintenanceTeam() {
            try {
                console.log('üì° Loading maintenance team from MtceTeamEmailList...');
                // const response = await makeRequest('getMtceTeamEmailList');
                // Simulate loading for now
                setTimeout(() => {
                    renderMaintenanceTable();
                }, 1000);
            } catch (error) {
                console.error('‚ùå Error loading maintenance team:', error);
                showError('maintenance', 'Failed to load maintenance team from Google Sheets');
            }
        }

        // Load zone representatives from Google Sheets  
        async function loadZoneRepresentatives() {
            try {
                console.log('üì° Loading zone representatives from ZoneRepsEmailList...');
                // const response = await makeRequest('getZoneRepsEmailList');
                // Simulate loading for now
                setTimeout(() => {
                    renderZoneRepsTable();
                }, 1200);
            } catch (error) {
                console.error('‚ùå Error loading zone representatives:', error);
                showError('zone', 'Failed to load zone representatives from Google Sheets');
            }
        }

        // Load inactive contacts from Google Sheets
        async function loadInactiveContacts() {
            try {
                console.log('üì° Loading inactive contacts...');
                // Implementation for loading inactive contacts
                setTimeout(() => {
                    renderInactiveTable();
                }, 800);
            } catch (error) {
                console.error('‚ùå Error loading inactive contacts:', error);
            }
        }

        // Render maintenance table with actual/sample data
        function renderMaintenanceTable() {
            const tbody = document.getElementById('maintenanceTableBody');
            tbody.innerHTML = maintenanceTeam.map((person, index) => `
                <tr>
                    <td class="editable" onclick="editCell(this, 'maintenance', ${person.id}, 'name')">${person.name}</td>
                    <td class="editable" onclick="editCell(this, 'maintenance', ${person.id}, 'email')">${person.email}</td>
                </tr>
            `).join('') + `
                <tr>
                    <td class="editable placeholder" onclick="editCell(this, 'maintenance', -1, 'name')">Enter name...</td>
                    <td class="editable placeholder" onclick="editCell(this, 'maintenance', -1, 'email')">Enter email address...</td>
                </tr>
            `;
        }

        // Render zone reps table with actual/sample data
        function renderZoneRepsTable() {
            const tbody = document.getElementById('zoneRepsTableBody');
            tbody.innerHTML = zoneReps.map((rep, index) => `
                <tr>
                    <td class="editable" onclick="editCell(this, 'zone', ${rep.id}, 'zone')">${rep.zone}</td>
                    <td class="editable" onclick="editCell(this, 'zone', ${rep.id}, 'name')">${rep.name}</td>
                    <td class="editable" onclick="editCell(this, 'zone', ${rep.id}, 'email')">${rep.email}</td>
                </tr>
            `).join('');
        }

        // Render inactive table
        function renderInactiveTable() {
            const tbody = document.getElementById('inactiveTableBody');
            if (inactiveContacts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 20px; color: #718096;">
                            No inactive contacts
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = inactiveContacts.map(contact => `
                    <tr>
                        <td>${contact.name}${contact.type === 'Zone Rep' ? '<br><small>Zone Rep</small>' : ''}</td>
                        <td>${contact.email}</td>
                        <td>${contact.type}</td>
                        <td class="date-removed">${contact.removed}</td>
                        <td>
                            <button class="action-btn restore-btn" onclick="restoreContact(${contact.id})">‚Ü©Ô∏è Restore</button>
                            <button class="action-btn delete-btn" onclick="deleteContact(${contact.id})">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Show submit button when changes are made
        function showSubmitButton(type) {
            const submitBtn = document.getElementById(`${type}SubmitBtn`);
            if (submitBtn) {
                submitBtn.classList.add('show');
            }
        }

        // Hide submit button after successful save
        function hideSubmitButton(type) {
            const submitBtn = document.getElementById(`${type}SubmitBtn`);
            if (submitBtn) {
                submitBtn.classList.remove('show');
            }
        }

        // Edit cell function
        function editCell(cell, type, id, field) {
            if (cell.classList.contains('editing') || cell.querySelector('.edit-input, .edit-select')) {
                return; // Already editing
            }

            const currentValue = cell.textContent.trim();
            cell.classList.add('editing');
            cell.classList.remove('placeholder');
            
            let input;
            if (field === 'zone') {
                input = document.createElement('select');
                input.className = 'edit-select';
                ['Zone 1', 'Zone 2', 'Zone 3', 'Zone 4', 'Zone 5'].forEach(zone => {
                    const option = document.createElement('option');
                    option.value = zone;
                    option.textContent = zone;
                    option.selected = zone === currentValue;
                    input.appendChild(option);
                });
            } else {
                input = document.createElement('input');
                input.type = field === 'email' ? 'email' : 'text';
                input.className = 'edit-input';
                input.value = currentValue === 'Enter name...' || currentValue === 'Enter email address...' ? '' : currentValue;
            }

            cell.innerHTML = '';
            cell.appendChild(input);
            input.focus();

            // Save on blur or enter
            const saveEdit = () => {
                const newValue = input.value.trim();
                cell.classList.remove('editing');
                
                if (newValue) {
                    cell.textContent = newValue;
                    // Show submit button when changes are made
                    showSubmitButton(type);
                    
                    // Here you would save to backend
                    console.log(`Modified ${type} ${id} ${field}: ${newValue}`);
                } else {
                    // Restore placeholder if empty
                    if (field === 'name') {
                        cell.textContent = 'Enter name...';
                        cell.classList.add('placeholder');
                    } else if (field === 'email') {
                        cell.textContent = 'Enter email address...';
                        cell.classList.add('placeholder');
                    } else {
                        cell.textContent = currentValue;
                    }
                }
            };

            // Cancel on escape
            const cancelEdit = () => {
                cell.classList.remove('editing');
                cell.textContent = currentValue;
            };

            input.addEventListener('blur', saveEdit);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelEdit();
                }
            });
        }

        // Show add modal function
        function showAddModal(type) {
            console.log(`Add new ${type} contact`);
            // Implementation for modal would go here
            alert(`Add new ${type} contact - Modal would open here`);
        }

        // Restore contact function
        function restoreContact(id) {
            const contact = inactiveContacts.find(c => c.id === id);
            if (contact && confirm(`Restore ${contact.name} to active ${contact.type.toLowerCase()} list?`)) {
                console.log(`Restoring contact ${id}:`, contact);
                
                // Move back to appropriate active list
                if (contact.type === 'Maintenance') {
                    maintenanceTeam.push({
                        id: Date.now(),
                        name: contact.name,
                        email: contact.email
                    });
                } else {
                    zoneReps.push({
                        id: Date.now(),
                        zone: contact.zone || 'Zone 1',
                        name: contact.name,
                        email: contact.email
                    });
                }
                
                // Remove from inactive
                inactiveContacts = inactiveContacts.filter(c => c.id !== id);
                
                // Refresh displays
                renderTables();
                alert(`${contact.name} restored successfully!`);
            }
        }

        // Delete contact permanently
        function deleteContact(id) {
            const contact = inactiveContacts.find(c => c.id === id);
            if (contact && confirm(`Permanently delete ${contact.name}? This cannot be undone.`)) {
                inactiveContacts = inactiveContacts.filter(c => c.id !== id);
                renderTables();
                console.log(`Permanently deleted contact ${id}`);
            }
        }

        // Submit functions for saving changes
        async function submitMaintenanceChanges() {
            try {
                console.log('üíæ Saving maintenance team changes to Google Sheets...');
                // await saveMaintenanceTeam();
                hideSubmitButton('maintenance');
                alert('Maintenance team changes saved successfully!');
            } catch (error) {
                console.error('‚ùå Error saving maintenance changes:', error);
                alert('Failed to save changes. Please try again.');
            }
        }

        async function submitZoneChanges() {
            try {
                console.log('üíæ Saving zone representative changes to Google Sheets...');
                // await saveZoneRepresentatives();
                hideSubmitButton('zone');
                alert('Zone representative changes saved successfully!');
            } catch (error) {
                console.error('‚ùå Error saving zone changes:', error);
                alert('Failed to save changes. Please try again.');
            }
        }

        // Show error function
        function showError(type, message) {
            console.error(`‚ùå ${type} error:`, message);
            alert(`Error: ${message}`);
        }

        console.log('üìß Email Notification Management - 3-Section Layout Ready!');
    </script>
</body>
</html>
